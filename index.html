<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>å†™çœŸãƒ“ãƒ³ã‚´ 4x4ï¼ˆã‚¹ãƒãƒ›æœ€é©åŒ– å®Œå…¨ç‰ˆï¼‰</title>

<!-- ã‚¹ãƒãƒ›å…¨ç”»é¢è¡¨ç¤º -->
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">

<style>
/* ---- ã‚¹ãƒãƒ›ã§è¦‹åˆ‡ã‚Œãªã„ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆã«ã™ã‚‹åŸºæœ¬è¨­å®š ---- */
* {
    box-sizing: border-box;
}

html, body {
    margin: 0;
    padding: 0;
    width: 100%;
    min-height: 100dvh; /* iPhone Safari ã®ã‚¢ãƒ‰ãƒ¬ã‚¹ãƒãƒ¼ã‚’è€ƒæ…® */
    background: #ffffff;
    font-family: sans-serif;
    overflow-x: hidden; /* æ¨ªã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ç¦æ­¢ */
}

h1 {
    margin: 8px 0;
    font-size: 20px;
}

/* ---- ãƒ“ãƒ³ã‚´ã‚°ãƒªãƒƒãƒ‰ï¼šç”»é¢ã«å®Œå…¨ãƒ•ã‚£ãƒƒãƒˆ ---- */
#bingo {
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    gap: 6px;
    width: 100%;
    max-width: 100%; /* å¹…ã‚’çµ¶å¯¾ã‚ªãƒ¼ãƒãƒ¼ã•ã›ãªã„ */
    margin: 0 auto;
}

/* ---- å„ãƒã‚¹ ---- */
.cell {
    border: 1px solid #ccc;
    padding: 6px;
    border-radius: 6px;
    background: #fafafa;
    display: flex;
    flex-direction: column;
    align-items: center;
    font-size: 12px;
    width: 100%; /* åˆ—å¹…ã¨å®Œå…¨ä¸€è‡´ */
}

.cell.completed {
    background: #d1ffd1;
    border: 2px solid #4caf50;
}

/* ---- ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰å…¥åŠ› ---- */
.keyword {
    width: 100%;
    margin-bottom: 4px;
    text-align: center;
    font-size: 12px;
    white-space: normal;      /* â† è‡ªå‹•ã§æŠ˜ã‚Šè¿”ã— */
    word-break: break-word;   /* â† é•·ã„å˜èªã‚‚æŠ˜ã‚Šè¿”ã™ */
}

/* ---- ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ç”»åƒ ---- */
.preview {
    width: 100%;         /* ã‚»ãƒ«å¹…ã„ã£ã±ã„ */
    max-width: 90px;     /* ã‚¹ãƒãƒ›ã§è¦‹ã‚„ã™ã„ä¸Šé™ */
    height: 90px;
    object-fit: cover;
    border-radius: 4px;
    background: #eee;
}

/* ---- ãƒœã‚¿ãƒ³ ---- */
.btn-small {
    margin-top: 4px;
    padding: 4px 6px;
    font-size: 11px;
}

/* ---- ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆï¼ã‚¤ãƒ³ãƒãƒ¼ãƒˆãƒœã‚¿ãƒ³ ---- */
.controls {
    padding: 8px;
}
</style>
</head>

<body>

<h1>ğŸ“¸ å†™çœŸãƒ“ãƒ³ã‚´ï¼ˆ4Ã—4ï¼‰</h1>

<div id="bingo"></div>

<div class="controls">
    <button onclick="exportData()">ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆï¼ˆJSONï¼‰</button>
    <input type="file" id="importFile" accept="application/json" style="display:none" onchange="importData(event)">
    <button onclick="document.getElementById('importFile').click()">ã‚¤ãƒ³ãƒãƒ¼ãƒˆ</button>
</div>

<script>
/* =========================================
   åˆæœŸãƒ‡ãƒ¼ã‚¿
========================================= */
let bingoData = [];
const defaultKeywords = [
    "ãã‚Œã„ãªæ™¯è‰²",
    "ãŠã„ã—ãã†ãªã‚‚ã®",
    "èª°ã‹ã®ç¬‘é¡”",
    "å…ƒæ°—ãªãŠã˜ã„ã¡ã‚ƒã‚“ï¼ˆãŠã°ã‚ã¡ã‚ƒã‚“ï¼‰",
    "å¤–æ¥æ¤ç‰©ï¼ˆç”Ÿç‰©ï¼‰",
    "æ˜”ã®æš®ã‚‰ã—ã‚’æ„Ÿã˜ã‚‹ã‚‚ã®",
    "ã€‡ã€‡ã«è¦‹ãˆãŸé›²",
    "é‡Œå±±ã®é¦™ã‚Š",
    "ã»ã£ã“ã‚Šã™ã‚‹ã‚‚ã®",
    "ãã™ã£ã¨ç¬‘ãˆã‚‹ã‚‚ã®",
    "æ–°ã—ã„å»ºç‰©ã€ã‚‚ã®",
    "å¤ã„å»ºç‰©ã€ã‚‚ã®",
    "æ­´å²ã‚’æ„Ÿã˜ã‚‹ã‚‚ã®",
    "ãªã‚“ã¨ãªãƒ¼ãè‰²",
    "å…¨ä½“ï¼ˆåºƒã„ï¼‰ã®æ™¯è‰²",
    ""
];

/* =========================================
   ãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿
========================================= */
function loadData() {
    try {
        const saved = localStorage.getItem("photoBingo4x4");
        if (saved) {
            bingoData = JSON.parse(saved);
        } else {
            bingoData = defaultKeywords.map(k => ({ keyword: k, image: "", completed: false }));
        }
    } catch {
        bingoData = defaultKeywords.map(k => ({ keyword: k, image: "", completed: false }));
    }
}

/* =========================================
   ãƒ‡ãƒ¼ã‚¿ä¿å­˜
========================================= */
function saveData() {
    try {
        localStorage.setItem("photoBingo4x4", JSON.stringify(bingoData));
    } catch {
        alert("âš  ä¿å­˜å®¹é‡ãŒã„ã£ã±ã„ã§ã™ã€‚å†™çœŸã‚’å‰Šé™¤ã—ã¦ãã ã•ã„ã€‚");
    }
}

/* =========================================
   å†™çœŸåœ§ç¸® â†’ Base64
========================================= */
function compressAndConvert(file, callback) {
    const reader = new FileReader();

    reader.onload = (e) => {
        const img = new Image();

        img.onload = () => {
            const maxWidth = 600;
            const scale = maxWidth / img.width;

            const canvas = document.createElement("canvas");
            canvas.width = Math.min(img.width, maxWidth);
            canvas.height = img.height * scale;

            const ctx = canvas.getContext("2d");
            ctx.drawImage(img, 0, 0, canvas.width, canvas.height);

            const base64 = canvas.toDataURL("image/jpeg", 0.8);
            callback(base64);
        };

        img.onerror = () => alert("âš  ç”»åƒã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸã€‚");

        img.src = e.target.result;
    };

    reader.onerror = () => alert("âš  ç”»åƒã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸã€‚");

    reader.readAsDataURL(file);
}

/* =========================================
   æç”»
========================================= */
function render() {
    const board = document.getElementById("bingo");
    board.innerHTML = "";

    bingoData.forEach((cell, index) => {
        const div = document.createElement("div");
        div.className = "cell" + (cell.completed ? " completed" : "");

        // ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰
        const input = document.createElement("input");
        input.type = "text";
        input.className = "keyword";
        input.value = cell.keyword;
        input.oninput = (e) => {
            bingoData[index].keyword = e.target.value;
            saveData();
        };
        div.appendChild(input);

        // ç”»åƒãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼
        const img = document.createElement("img");
        img.className = "preview";
        img.src = cell.image || "";
        div.appendChild(img);

        // å†™çœŸã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰
        const fileInput = document.createElement("input");
        fileInput.type = "file";
        fileInput.accept = "image/*";
        fileInput.capture = "environment";
        fileInput.style.display = "none";

        fileInput.onchange = (event) => {
            const file = event.target.files?.[0];
            if (!file) {
                alert("âš  å†™çœŸãŒå–å¾—ã§ãã¾ã›ã‚“ã§ã—ãŸã€‚ã‚‚ã†ä¸€åº¦ãŠè©¦ã—ãã ã•ã„ã€‚");
                return;
            }

            compressAndConvert(file, (base64) => {
                bingoData[index].image = base64;
                saveData();
                render();
            });
        };

        const btn = document.createElement("button");
        btn.textContent = "å†™çœŸã‚’æ’®ã‚‹/é¸ã¶";
        btn.className = "btn-small";
        btn.onclick = () => fileInput.click();
        div.appendChild(btn);
        div.appendChild(fileInput);

        // å®Œäº†ãƒœã‚¿ãƒ³
        const okBtn = document.createElement("button");
        okBtn.textContent = "ç¢ºèªã—ã¦OK";
        okBtn.className = "btn-small";
        okBtn.onclick = () => {
            bingoData[index].completed = true;
            saveData();
            render();
        };
        div.appendChild(okBtn);

        board.appendChild(div);
    });
}

/* =========================================
   ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆãƒ»ã‚¤ãƒ³ãƒãƒ¼ãƒˆ
========================================= */
function exportData() {
    const blob = new Blob([JSON.stringify(bingoData)], { type: "application/json" });
    const a = document.createElement("a");
    a.href = URL.createObjectURL(blob);
    a.download = "bingo4x4_export.json";
    a.click();
}

function importData(event) {
    const file = event.target.files?.[0];
    if (!file) return;

    const reader = new FileReader();
    reader.onload = () => {
        bingoData = JSON.parse(reader.result);
        saveData();
        render();
        alert("ã‚¤ãƒ³ãƒãƒ¼ãƒˆå®Œäº†ï¼");
    };
    reader.readAsText(file);
}

/* =========================================
   åˆæœŸåŒ–
========================================= */
loadData();
render();
</script>

</body>
</html>


