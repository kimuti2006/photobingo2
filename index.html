<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>å†™çœŸãƒ“ãƒ³ã‚´ 4x4</title>
<style>
    body {
        font-family: sans-serif;
        padding: 20px;
        text-align: center;
    }
    #bingo {
        display: grid;
        grid-template-columns: repeat(4, 1fr);
        gap: 8px;
        max-width: 500px;
        margin: 0 auto;
    }
    .cell {
        border: 1px solid #ccc;
        padding: 8px;
        border-radius: 6px;
        background: #fafafa;
        display: flex;
        flex-direction: column;
        align-items: center;
        font-size: 14px;
    }
    .cell.completed {
        background: #d1ffd1;
        border: 2px solid #4caf50;
    }
    .keyword {
        width: 90%;
        margin-bottom: 6px;
        text-align: center;
    }
    .preview {
        width: 100px;
        height: 100px;
        object-fit: cover;
        border-radius: 4px;
        margin-top: 4px;
        background: #eee;
    }
    .btn-small {
        margin-top: 4px;
        padding: 4px 8px;
        font-size: 12px;
    }
</style>
</head>
<body>

<h1>ğŸ“¸ å†™çœŸãƒ“ãƒ³ã‚´ï¼ˆ4Ã—4ï¼‰</h1>

<div id="bingo"></div>

<br>

<button onclick="exportData()">ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆï¼ˆJSONï¼‰</button>
<input type="file" id="importFile" accept="application/json" style="display:none" onchange="importData(event)">
<button onclick="document.getElementById('importFile').click()">ã‚¤ãƒ³ãƒãƒ¼ãƒˆ</button>

<script>
const SIZE = 4;
let bingoData = [];

// æŒ‡å®šã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ï¼ˆ15å€‹ï¼‰ã€æ®‹ã‚Š1ã¤ã¯ç©ºæ¬„
const defaultKeywords = [
    "ãã‚Œã„ãªæ™¯è‰²",
    "ãŠã„ã—ãã†ãªã‚‚ã®",
    "èª°ã‹ã®ç¬‘é¡”",
    "å…ƒæ°—ãªãŠã˜ã„ã¡ã‚ƒã‚“ï¼ˆãŠã°ã‚ã¡ã‚ƒã‚“ï¼‰",
    "å¤–æ¥æ¤ç‰©ï¼ˆç”Ÿç‰©ï¼‰",
    "æ˜”ã®æš®ã‚‰ã—ã‚’æ„Ÿã˜ã‚‹ã‚‚ã®",
    "ã€‡ã€‡ã«è¦‹ãˆãŸé›²",
    "é‡Œå±±ã®é¦™ã‚Š",
    "ã»ã£ã“ã‚Šã™ã‚‹ã‚‚ã®",
    "ãã™ã£ã¨ç¬‘ãˆã‚‹ã‚‚ã®",
    "æ–°ã—ã„å»ºç‰©ã€ã‚‚ã®",
    "å¤ã„å»ºç‰©ã€ã‚‚ã®",
    "æ­´å²ã‚’æ„Ÿã˜ã‚‹ã‚‚ã®",
    "ãªã‚“ã¨ãªãƒ¼ãè‰²",
    "å…¨ä½“ï¼ˆåºƒã„ï¼‰ã®æ™¯è‰²",
    "" // æ®‹ã‚Šã®1ãƒã‚¹ã¯è‡ªç”±å…¥åŠ›
];

/* -------------------------------
   åˆæœŸãƒ‡ãƒ¼ã‚¿ç”Ÿæˆ or ãƒ­ãƒ¼ãƒ‰
-------------------------------- */
function loadData() {
    const saved = localStorage.getItem("photoBingo4x4");
    if (saved) {
        bingoData = JSON.parse(saved);
    } else {
        bingoData = defaultKeywords.map(k => ({
            keyword: k,
            image: "",
            completed: false
        }));
    }
}

/* -------------------------------
   ãƒ‡ãƒ¼ã‚¿ä¿å­˜
-------------------------------- */
function saveData() {
    localStorage.setItem("photoBingo4x4", JSON.stringify(bingoData));
}

/* -------------------------------
   ã‚«ãƒ¼ãƒ‰æç”»
-------------------------------- */
function render() {
    const board = document.getElementById("bingo");
    board.innerHTML = "";

    bingoData.forEach((cell, index) => {
        const div = document.createElement("div");
        div.className = "cell" + (cell.completed ? " completed" : "");

        // ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰å…¥åŠ›
        const input = document.createElement("input");
        input.type = "text";
        input.placeholder = "ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰";
        input.value = cell.keyword;
        input.className = "keyword";
        input.oninput = (e) => {
            bingoData[index].keyword = e.target.value;
            saveData();
        };
        div.appendChild(input);

        // ç”»åƒãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼
        const img = document.createElement("img");
        img.className = "preview";
        img.src = cell.image || "";
        div.appendChild(img);

        // å†™çœŸãƒœã‚¿ãƒ³
        const photoInput = document.createElement("input");
        photoInput.type = "file";
        photoInput.accept = "image/*";
        photoInput.capture = "environment";
        photoInput.style.display = "none";
        photoInput.onchange = (e) => {
            const file = e.target.files[0];
            if (file) {
                const url = URL.createObjectURL(file);
                bingoData[index].image = url;
                saveData();
                render();
            }
        };

        const photoBtn = document.createElement("button");
        photoBtn.textContent = "å†™çœŸã‚’æ’®ã‚‹/é¸ã¶";
        photoBtn.className = "btn-small";
        photoBtn.onclick = () => photoInput.click();
        div.appendChild(photoBtn);
        div.appendChild(photoInput);

        // ç¢ºèªOK
        const okBtn = document.createElement("button");
        okBtn.textContent = "ç¢ºèªã—ã¦OK";
        okBtn.className = "btn-small";
        okBtn.onclick = () => {
            bingoData[index].completed = true;
            saveData();
            render();
        };
        div.appendChild(okBtn);

        board.appendChild(div);
    });
}

/* -------------------------------
   ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ
-------------------------------- */
function exportData() {
    const blob = new Blob([JSON.stringify(bingoData)], { type: "application/json" });
    const a = document.createElement("a");
    a.href = URL.createObjectURL(blob);
    a.download = "bingo4x4_export.json";
    a.click();
}

/* -------------------------------
   ã‚¤ãƒ³ãƒãƒ¼ãƒˆ
-------------------------------- */
function importData(event) {
    const file = event.target.files[0];
    if (!file) return;
    
    const reader = new FileReader();
    reader.onload = () => {
        bingoData = JSON.parse(reader.result);
        saveData();
        render();
        alert("ã‚¤ãƒ³ãƒãƒ¼ãƒˆãŒå®Œäº†ã—ã¾ã—ãŸï¼");
    };
    reader.readAsText(file);
}

/* -------------------------------
   åˆæœŸåŒ–
-------------------------------- */
loadData();
render();
</script>

</body>
</html>
